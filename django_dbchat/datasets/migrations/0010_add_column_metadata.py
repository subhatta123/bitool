# Generated by Django 4.2.7 on 2025-06-24 12:56

from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ("datasets", "0009_fix_semantic_column_foreign_key"),
    ]

    operations = [
        migrations.CreateModel(
            name="ColumnMetadata",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        db_index=True, help_text="Physical column name", max_length=200
                    ),
                ),
                (
                    "display_name",
                    models.CharField(help_text="Human-readable name", max_length=200),
                ),
                (
                    "description",
                    models.TextField(blank=True, help_text="Column description"),
                ),
                (
                    "data_type",
                    models.CharField(
                        help_text="Data type (e.g., string, integer, float)",
                        max_length=50,
                    ),
                ),
                (
                    "semantic_type",
                    models.CharField(
                        blank=True,
                        help_text="Semantic type (dimension, measure, etc.)",
                        max_length=50,
                    ),
                ),
                (
                    "sample_values",
                    models.JSONField(
                        blank=True, default=list, help_text="Sample values"
                    ),
                ),
                ("is_nullable", models.BooleanField(default=True)),
                (
                    "created_at",
                    models.DateTimeField(
                        db_index=True, default=django.utils.timezone.now
                    ),
                ),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Column Metadata",
                "verbose_name_plural": "Column Metadata",
                "db_table": "column_metadata",
            },
        ),
        migrations.AlterUniqueTogether(
            name="semanticrelationship",
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name="semanticrelationship",
            name="verified_by",
        ),
        migrations.RemoveIndex(
            model_name="semanticcolumn",
            name="semantic_co_table_i_3ef6c8_idx",
        ),
        migrations.AlterUniqueTogether(
            name="semanticcolumn",
            unique_together=set(),
        ),
        migrations.RemoveField(
            model_name="semanticmetric",
            name="tags",
        ),
        migrations.RemoveField(
            model_name="semantictable",
            name="tags",
        ),
        migrations.AddField(
            model_name="semanticcolumn",
            name="semantic_table",
            field=models.ForeignKey(
                db_column="semantic_table_id",
                default=django.utils.timezone.now,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="columns",
                to="datasets.semantictable",
            ),
            preserve_default=False,
        ),
        migrations.AlterUniqueTogether(
            name="semanticcolumn",
            unique_together={("semantic_table", "name")},
        ),
        migrations.AddIndex(
            model_name="semanticcolumn",
            index=models.Index(
                fields=["semantic_table", "name"], name="semantic_co_semanti_c696f6_idx"
            ),
        ),
        migrations.DeleteModel(
            name="SemanticRelationship",
        ),
        migrations.AddField(
            model_name="columnmetadata",
            name="data_source",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="column_metadata",
                to="datasets.datasource",
            ),
        ),
        migrations.RemoveField(
            model_name="semanticcolumn",
            name="table",
        ),
        migrations.RemoveField(
            model_name="semanticcolumn",
            name="tags",
        ),
        migrations.AddIndex(
            model_name="columnmetadata",
            index=models.Index(
                fields=["data_source", "name"], name="column_meta_data_so_a3f532_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="columnmetadata",
            unique_together={("data_source", "name")},
        ),
    ]
